<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mahsulotlar</title>
    <link rel="stylesheet" href="/css/public-products.css" />
</head>

<body>
    <div class="page">
        <main class="container">

            <section class="hero">
                <div>
                    <h1>Mahsulotlar</h1>
                    <p>Qidirish va filter orqali mahsulotlarni toping.</p>
                </div>
            </section>

            <!-- FILTER + SEARCH -->
            <section class="card filter-card">
                <form class="filterform" method="GET" action="/">
                    <div class="fgroup">
                        <label>Qidirish</label>
                        <input class="finput" type="text" name="q" value="<%= filters?.q || '' %>"
                            placeholder="Masalan: Cledbel" />
                    </div>

                    <div class="fgroup">
                        <label>Teg</label>
                        <select class="fselect" name="tag">
                            <option value="ALL" <%=(filters?.tag==='ALL' )?'selected':'' %>>Barchasi</option>
                            <% (productTagsEnum || []).forEach(function(t){ %>
                                <option value="<%= t %>" <%=(filters?.tag===t)?'selected':'' %>>
                                    <%= productTagLabels?.[t] || t %>
                                </option>
                                <% }) %>
                        </select>
                    </div>

                    <div class="fgroup">
                        <label>Saralash</label>
                        <select class="fselect" name="sort">
                            <option value="newest" <%=(filters?.sort==='newest' )?'selected':'' %>>Eng yangi</option>
                            <option value="oldest" <%=(filters?.sort==='oldest' )?'selected':'' %>>Eng eski</option>
                            <option value="price_asc" <%=(filters?.sort==='price_asc' )?'selected':'' %>>Narx (↑)
                            </option>
                            <option value="price_desc" <%=(filters?.sort==='price_desc' )?'selected':'' %>>Narx (↓)
                            </option>
                            <option value="name_asc" <%=(filters?.sort==='name_asc' )?'selected':'' %>>Nom (A→Z)
                            </option>
                            <option value="name_desc" <%=(filters?.sort==='name_desc' )?'selected':'' %>>Nom (Z→A)
                            </option>
                        </select>
                    </div>



                    <div class="fgroup fgroup-clear">
                        <button type="button" class="btn-clear" id="clearFilters">
                            Tozalash
                        </button>
                    </div>

                </form>
            </section>

            <!-- Cards -->
            <section class="card">
                <div class="card-head">
                    <div class="card-title">Natijalar</div>
                    <div class="card-note" id="countNote">
                        <%= products?.length || 0 %> ta mahsulot
                    </div>
                </div>

                <div class="cards-wrap" id="cardsWrap">

                    <% if (products && products.length) { %>
                        <% products.forEach(function(p){ %>
                            <div class="pCard">
                                <div class="pImage">
                                    <% if (p.productImages && p.productImages.length) { %>
                                        <img src="/<%= p.productImages[0] %>" alt="<%= p.productName %>"
                                            onerror="this.outerHTML='<div class=&quot;pNoImg&quot;>Rasm yo‘q</div>';" />
                                        <% } else { %>
                                            <div class="pNoImg">Rasm yo‘q</div>
                                            <% } %>
                                </div>

                                <div class="pBody">
                                    <div class="pTitle">
                                        <%= p.productName %>
                                    </div>

                                    <div class="pDesc">
                                        <%= p.productDesc ? p.productDesc : 'Product description goes here.' %>
                                    </div>

                                    <div class="pBottom">
                                        <div class="pPrices">
                                            <span class="pPrice">$<%= p.productPrice %> so`m</span>

                                            <% if (p.productOldPrice && p.productOldPrice> p.productPrice) { %>
                                                <span class="pOldPrice">$<%= p.productOldPrice %></span>
                                                <% } %>
                                        </div>

                                        <% if (p.productDiscountPercent) { %>
                                            <div class="pOff">
                                                <%= p.productDiscountPercent %>% off
                                            </div>
                                            <% } %>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <div class="empty">Hech narsa topilmadi.</div>
                                    <% } %>
                </div>
                <div class="pager" id="pager" hidden>
                    <button type="button" class="pg-btn" id="pgPrev">← Oldingi</button>
                    <button type="button" class="pg-btn" id="pgNext">Keyingi →</button>
                </div>


            </section>

        </main>
    </div>

    <script src="/js/public-products.js"></script>
</body>

</html>